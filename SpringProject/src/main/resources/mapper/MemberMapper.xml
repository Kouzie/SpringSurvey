<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.sist.project.mapper.MemberMapper">
	<select id="selectAdminList" resultType="MemberVO">
		SELECT tbl_member.member_seq, username, password, enabled, name, birth, gender, image, email
		FROM tbl_member
		JOIN tbl_auth ON tbl_member.member_seq = tbl_auth.member_seq
		WHERE tbl_auth.authority = 'ROLE_ADMIN'
	</select>
	<insert id="insertMember">
		INSERT INTO tbl_member (member_seq, username, email, password, name, birth, gender, image) VALUES
		(seq_member.nextval, #{username}, #{email}, #{password}, #{name}, #{birth}, #{gender}, #{image, jdbcType=VARCHAR})
		<!-- null처리를 위해 타입 명시 -->
	</insert>
	<update id="updateMember">
		UPDATE tbl_member set password = #{password}, name = #{name}, birth = #{birth}, gender = #{gender}, image = #{image, jdbcType=VARCHAR}
		WHERE username = #{username}
	</update>
	
	<delete id="deleteMember">
		UPDATE tbm_member SET email='', password='' WHERE member_seq = #{ member_seq }
	</delete>
	<select id="selectUserById" resultType="MemberDetails">
        <![CDATA[
            SELECT tbl_member.*, tbl_auth.authority
            FROM tbl_member
            JOIN tbl_auth ON tbl_member.member_seq = tbl_auth.member_seq
            WHERE username = #{username}
        ]]>
    </select>
    <select id="selectUsername" resultType="String">
    	SELECT username 
    	FROM tbl_member 
    	WHERE username = #{ username }
    </select>
    <select id="selectUserEmail" resultType="String">
    	SELECT email 
    	FROM tbl_member 
    	WHERE username = #{ username }
    </select>
    <update id="updateUserPassword">
    	UPDATE tbl_member SET
    	password = #{password}
    	WHERE username = #{username}
    </update>
    
<select id="selectSearchMember" resultType="MemberVO">
select member_seq, username, name, email, birth, enabled from tbl_member 
where ${searchOption}  like
concat('%', concat( '${searchWord}', '%'))
</select>

<update id="updateMemberUnabled">
update tbl_member set enabled=0 
where member_seq in 

<foreach item="UpdateMemberVO" index="index" collection="list"
      open="(" separator="," close=")">
        #{member_seqList}
  </foreach>

</update>
<!-- <update id="updateMemberUnabled2" >
update tbl_member set enabled=0 
where member_seq in 

<foreach item="member_seqList" index="index" collection="arrayList"
      open="(" separator="," close=")">
        #{member_seq}
  </foreach>

</update> -->
</mapper>